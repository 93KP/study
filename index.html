<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hidden Truth — Secure Reader</title>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.142/pdf.min.js"></script>
<script>
  // IMPORTANT: tell pdf.js where its worker is
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.142/pdf.worker.min.js";
</script>

<style>
  /* ===== Legendary UI (mobile-first) ===== */
  :root{
    --accent1:#ff7a18;
    --accent2:#af002d;
    --glass: rgba(255,255,255,0.06);
    --muted: rgba(255,255,255,0.75);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  body{
    background: radial-gradient(800px 400px at 10% 10%, rgba(255,122,24,0.08), transparent),
                linear-gradient(180deg,#071428,#0b1f2f 40%, #04141e 100%);
    color:#eaf6ff;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }

  /* Big hero container */
  .hero {
    width:100%;
    max-width:1100px;
    display:grid;
    grid-template-columns: 1fr;
    gap:20px;
    align-items:start;
  }

  @media(min-width:920px){
    .hero { grid-template-columns: 420px 1fr; }
  }

  /* Left card */
  .card {
    border-radius:20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    padding:28px;
    box-shadow: 0 30px 80px rgba(2,6,23,0.6);
    border: 1px solid rgba(255,255,255,0.04);
    position:relative;
  }

  .logo {
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:18px;
  }
  .logo .icon{
    width:62px; height:62px; border-radius:12px;
    background: linear-gradient(135deg,var(--accent1),var(--accent2));
    display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:22px; color:#fff; box-shadow: 0 8px 30px rgba(175,0,45,0.18);
  }
  .logo h1{margin:0;font-size:20px; letter-spacing:0.6px;}
  .logo p{margin:0;font-size:12px;color:var(--muted)}

  .title { font-size:26px; margin:10px 0 6px; line-height:1.05; }
  .desc { color:var(--muted); margin-bottom:18px; font-size:14px; }

  .input-wrap { display:flex; gap:12px; align-items:center; }
  input#password {
    flex:1;
    padding:14px 16px;
    border-radius:12px;
    border:none;
    background:rgba(255,255,255,0.06);
    color:#fff;
    font-size:16px;
    outline: none;
    box-shadow: inset 0 -2px 0 rgba(0,0,0,0.25);
  }

  .btn {
    min-width:130px;
    padding:14px 18px;
    border-radius:12px;
    border:none;
    cursor:pointer;
    font-weight:800;
    letter-spacing:0.6px;
    color:#08121a;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    box-shadow: 0 12px 30px rgba(175,0,45,0.18), 0 6px 18px rgba(2,6,23,0.25);
    transition: transform .12s ease, box-shadow .12s;
  }
  .btn:active{ transform: translateY(2px); }

  .status { margin-top:12px; font-size:13px; color:#cfeef8; min-height:18px }

  .hint { margin-top:18px; font-size:13px; color:rgba(255,255,255,0.6) }

  /* Right: PDF viewer panel */
  .viewer {
    border-radius:20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:18px;
    min-height:360px;
    display:flex;
    flex-direction:column;
    align-items:stretch;
    box-shadow: 0 30px 80px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.03);
  }

  .viewer-top {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:12px;
  }
  .viewer-title { font-size:16px; font-weight:700; }
  .viewer-actions { display:flex; gap:8px; align-items:center; }

  .btn-ghost {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.06);
    color: #eaf6ff;
    padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700;
  }

  #pdf-container {
    flex:1;
    overflow:auto;
    padding:10px;
    display:none;
    position:relative;
  }
  #pdf-container .canvas-wrap { margin-bottom:18px; display:flex; justify-content:center; }
  canvas { background:#fff; border-radius:10px; box-shadow: 0 10px 30px rgba(2,6,23,0.5); width:100% !important; height:auto !important; }

  /* watermark */
  .watermark {
    position:absolute;
    top:50%; left:50%;
    transform: translate(-50%,-50%) rotate(-25deg);
    font-size:36px; color:rgba(255,255,255,0.06); font-weight:800;
    pointer-events:none; z-index:40; white-space:nowrap;
  }

  /* loader overlay */
  .loader {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.6));
    z-index:60; border-radius:12px; display:none;
  }
  .spinner {
    width:72px; height:72px; border-radius:50%;
    background: conic-gradient(var(--accent1), var(--accent2), #ffffff22, var(--accent1));
    animation:spin 1.3s linear infinite;
    box-shadow: 0 16px 40px rgba(0,0,0,0.6);
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* back button */
  .back {
    padding:8px 12px; border-radius:10px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.04);
    color:#eaf6ff; cursor:pointer; font-weight:700;
  }

  /* ADMIN modal */
  .admin-btn { position:absolute; right:14px; top:14px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:#eaf6ff; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; font-size:12px; }
  .modal {
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:2000;
    background: rgba(2,6,23,0.6);
  }
  .modal .panel {
    width:95%; max-width:820px; background:#001021; border-radius:12px; padding:18px; color:#eaf6ff;
  }
  .modal textarea { width:100%; height:340px; background:#021826; color:#dff9ff; border-radius:8px; padding:12px; border:none; font-family:monospace; }
  .modal .row { display:flex; gap:8px; margin-top:12px; justify-content:flex-end; }
  .modal .small { font-size:13px; color:#9fdff2; }

  footer { text-align:center; margin-top:14px; font-size:12px; color:rgba(255,255,255,0.45) }
</style>
</head>
<body>

<div class="hero">
  <!-- LEFT: Login card -->
  <div class="card" id="loginCard">
    <button class="admin-btn" id="adminBtn">Admin</button>
    <div class="logo">
      <div class="icon">HT</div>
      <div>
        <h1>HIDDEN TRUTH</h1>
        <p>Secure reader — enter your access code</p>
      </div>
    </div>

    <div class="title">Open your copy — fast & secure</div>
    <div class="desc">Enter the password you received. The book will open inside the page with a watermark (password + time).</div>

    <div class="input-wrap" style="margin-top:16px">
      <input id="password" placeholder="userXXXX" autocomplete="off" />
      <button class="btn" id="unlockBtn">UNLOCK</button>
    </div>

    <div class="status" id="status"> </div>
    <div class="hint">Tip: press Enter to unlock • Use the code sent to you</div>
    <footer style="margin-top:12px">© 2026 Kushagra</footer>
  </div>

  <!-- RIGHT: Viewer -->
  <div class="viewer" id="viewerPanel" style="display:none;">
    <div class="viewer-top">
      <div class="viewer-title" id="viewerTitle">Hidden Truth — Reader</div>
      <div class="viewer-actions">
        <button class="back" id="backBtn">← Back</button>
        <button class="btn-ghost" id="downloadBtn" style="display:none">Download</button>
      </div>
    </div>

    <div id="pdf-container">
      <div class="watermark" id="watermark"></div>
      <div id="canvasRoot"></div>
      <div class="loader" id="loader"><div class="spinner"></div></div>
    </div>
  </div>
</div>

<!-- Admin modal (hidden by default) -->
<div class="modal" id="adminModal">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div><strong>Admin — All Passwords</strong><div class="small">You can copy or download CSV</div></div>
      <div><button id="closeAdmin" class="btn-ghost">Close</button></div>
    </div>

    <div style="margin-top:12px;">
      <input id="adminKeyInput" placeholder="Enter admin key" style="padding:10px;border-radius:8px;border:none;background:#01202a;color:#dff9ff;width:100%;box-sizing:border-box"/>
    </div>

    <textarea id="adminList" readonly placeholder="Passwords will appear here once admin key is entered..."></textarea>

    <div class="row">
      <button id="copyBtn" class="btn-ghost">Copy</button>
      <button id="downloadCsvBtn" class="btn">Download CSV</button>
    </div>
  </div>
</div>

<script>
/* ================== PASSWORDS (200 unique random userXXXX) ================== */

function randFourDigit(){
  // return integer between 1000 and 9999 (inclusive)
  return Math.floor(Math.random() * 9000) + 1000;
}

function generateUnique(count){
  const s = new Set();
  while(s.size < count){
    s.add(randFourDigit());
  }
  return Array.from(s);
}

// generate 200 unique 4-digit numbers
const randomNums = generateUnique(200);

// shuffle them so assignment isn't predictable
(function shuffleInPlace(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
})(randomNums);

// build accessMap: first 100 -> ht.pdf, next 100 -> ht1.pdf
const accessMap = {};
randomNums.slice(0,100).forEach(n => accessMap["user"+String(n)] = "ht.pdf");
randomNums.slice(100).forEach(n => accessMap["user"+String(n)] = "ht1.pdf");

// Optional: (developer) log first few for quick testing
console.log("Sample random passwords:", Object.keys(accessMap).slice(0,8));

/* ----------------- ADMIN KEY (change if you want) ----------------- */
const ADMIN_KEY = "show200pls";

/* ================== UI / PDF logic ================== */

const unlockBtn = document.getElementById("unlockBtn");
const passwordInput = document.getElementById("password");
const statusEl = document.getElementById("status");
const loginCard = document.getElementById("loginCard");
const viewerPanel = document.getElementById("viewerPanel");
const pdfContainer = document.getElementById("pdf-container");
const canvasRoot = document.getElementById("canvasRoot");
const loader = document.getElementById("loader");
const watermarkDiv = document.getElementById("watermark");
const backBtn = document.getElementById("backBtn");
const viewerTitle = document.getElementById("viewerTitle");

function showStatus(txt,color){
  statusEl.textContent = txt || "";
  if(color) statusEl.style.color = color; else statusEl.style.color = "";
}

function clearViewer(){
  canvasRoot.innerHTML = "";
  watermarkDiv.textContent = "";
}

function showLoader(on){
  loader.style.display = on ? "flex" : "none";
}

/* handle Enter key */
passwordInput.addEventListener("keydown", function(e){
  if(e.key === "Enter") unlock();
});

/* Back button */
backBtn.addEventListener("click", ()=>{
  viewerPanel.style.display = "none";
  pdfContainer.style.display = "none";
  loginCard.style.display = "block";
  clearViewer();
  showStatus("");
  passwordInput.value = "";
  window.scrollTo({top:0,behavior:"smooth"});
});

/* Unlock handler */
unlockBtn.addEventListener("click", unlock);

async function unlock(){
  const pw = (passwordInput.value||"").trim();
  if(!pw){ showStatus("Enter password", "tomato"); return; }
  const pdfFile = accessMap[pw];
  if(!pdfFile){ showStatus("Invalid password", "tomato"); return; }

  // go to viewer
  loginCard.style.display = "none";
  viewerPanel.style.display = "flex";
  pdfContainer.style.display = "block";
  viewerTitle.textContent = `Hidden Truth — ${pdfFile.replace('.pdf','')}`;

  // show watermark text (password + date)
  const stamp = `${pw} • ${new Date().toLocaleString()}`;
  watermarkDiv.textContent = stamp;

  // render PDF
  clearViewer();
  showLoader(true);
  try {
    // pdfFile is relative path (ht.pdf / ht1.pdf) so it works on GitHub Pages
    const loadingTask = pdfjsLib.getDocument(pdfFile);
    const pdf = await loadingTask.promise;

    const scaleBase = window.innerWidth < 600 ? 1.05 : 1.5;

    for(let i=1;i<=pdf.numPages;i++){
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({ scale: scaleBase });
      // create canvas
      const wrap = document.createElement('div');
      wrap.className = 'canvas-wrap';
      const canvas = document.createElement('canvas');
      wrap.appendChild(canvas);
      canvasRoot.appendChild(wrap);

      // set size and render
      const ctx = canvas.getContext('2d');
      canvas.width = Math.floor(viewport.width);
      canvas.height = Math.floor(viewport.height);

      await page.render({ canvasContext: ctx, viewport }).promise;
      // slight delay to keep UI smooth
      await new Promise(r => setTimeout(r, 60));
    }

    showStatus("", "");
  } catch (err) {
    console.error("PDF render failed:", err);
    showStatus("Failed to load PDF — check filenames & GitHub Pages", "tomato");
  } finally {
    showLoader(false);
  }
}

/* ================== ADMIN modal logic ================== */
const adminBtn = document.getElementById("adminBtn");
const adminModal = document.getElementById("adminModal");
const closeAdmin = document.getElementById("closeAdmin");
const adminKeyInput = document.getElementById("adminKeyInput");
const adminList = document.getElementById("adminList");
const copyBtn = document.getElementById("copyBtn");
const downloadCsvBtn = document.getElementById("downloadCsvBtn");

adminBtn.addEventListener("click", ()=> {
  adminModal.style.display = "flex";
  adminKeyInput.value = "";
  adminList.value = "";
  adminKeyInput.focus();
});

closeAdmin.addEventListener("click", ()=> adminModal.style.display = "none");

adminKeyInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") showAdminList();
});

function showAdminList(){
  const key = (adminKeyInput.value||"").trim();
  if(key !== ADMIN_KEY){
    adminList.value = "Wrong admin key.";
    return;
  }
  // build list: password,assigned_pdf
  const lines = Object.keys(accessMap).map(pw => pw + "," + accessMap[pw]);
  adminList.value = lines.join("\n");
}

copyBtn.addEventListener("click", async ()=>{
  if(!adminList.value) return;
  try {
    await navigator.clipboard.writeText(adminList.value);
    copyBtn.textContent = "Copied!";
    setTimeout(()=> copyBtn.textContent = "Copy", 1500);
  } catch(e){ console.error(e); alert("Copy failed"); }
});

downloadCsvBtn.addEventListener("click", ()=>{
  if(!adminList.value) return alert("Enter admin key and load list first");
  const blob = new Blob([adminList.value], {type: "text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "hidden-truth-passwords.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

/* Optional: show first few generated passwords in console for admin use */
console.log("Admin sample passwords (first 8):", Object.keys(accessMap).slice(0,8));
</script>
</body>
</html>
